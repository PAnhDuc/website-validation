name: Validate Directory Structure and Deploy to GitHub Pages

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pages: write
  id-token: write  # C·∫ßn thi·∫øt n·∫øu s·ª≠ d·ª•ng GitHub OIDC authentication

jobs:
  validate-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Install htmlhint
      - name: Install htmlhint
        run: npm install -g htmlhint

      # 3. Check Project Directory Structure
      - name: Check Project Directory Structure
        run: |
          echo "üîç Validating directory structure..."
          if [ ! -d "assets" ] || [ ! -f "index.html" ] || [ ! -d "styles" ] || [ ! -d "scripts" ]; then
            echo "‚ùå Error: Project directory does not meet required structure."
            echo "Required structure:"
            echo "- index.html"
            echo "- assets/ (folder)"
            echo "- styles/ (folder)"
            echo "- scripts/ (folder)"
            exit 1
          else
            echo "‚úÖ Directory structure is valid."
          fi

      # 4. Validate HTML files (n·∫øu c·∫ßn)
      - name: Validate HTML files
        run: |
          echo "üîç Checking for HTML files..."
          html_files=$(find . -type f -name "*.html")
          if [ -n "$html_files" ]; then
            echo "üîç Validating HTML files..."
            htmlhint "**/*.html" || exit 1
          else
            echo "‚ö†Ô∏è No HTML files found. Skipping validation."
          fi

      # 5. Validate CSS files (n·∫øu c·∫ßn)
      - name: Validate CSS files
        run: |
          echo "üîç Checking for CSS files..."
          css_files=$(find . -type f -name "*.css")
          if [ -n "$css_files" ]; then
            echo "üîç Validating CSS files..."
            npx stylelint "**/*.css" --allow-empty-input || exit 1
          else
            echo "‚ö†Ô∏è No CSS files found. Skipping validation."
          fi

      # 6. Validate JavaScript files (n·∫øu c·∫ßn)
      - name: Validate JavaScript files
        run: |
          echo "üîç Checking for JavaScript files..."
          js_files=$(find . -type f -name "*.js")
          if [ -n "$js_files" ]; then
            echo "üîç Validating JavaScript files..."
            npx eslint "**/*.js" --format stylish || exit 1
          else
            echo "‚ö†Ô∏è No JavaScript files found. Skipping validation."
          fi

      # 7. Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./ # Thay th·∫ø b·∫±ng th∆∞ m·ª•c b·∫°n mu·ªën deploy (v√≠ d·ª•: dist)
